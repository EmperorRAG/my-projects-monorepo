# =================================================================================================
# Security Headers Configuration Snippet
# =================================================================================================
#
# This snippet provides comprehensive security headers that should be included in all server
# blocks across the NGINX infrastructure.
#
# Usage:
#   include /etc/nginx/snippets/headers.conf;
#
# These headers help protect against common web vulnerabilities including:
# - Cross-Site Scripting (XSS)
# - Clickjacking
# - MIME type sniffing
# - Information disclosure
#
# Reference: https://owasp.org/www-project-secure-headers/
# =================================================================================================

# X-Content-Type-Options
# Prevents MIME type sniffing, forcing the browser to respect the declared Content-Type
add_header X-Content-Type-Options "nosniff" always;

# X-Frame-Options
# Protects against clickjacking attacks by preventing the page from being embedded in iframes
# SAMEORIGIN allows framing only from the same origin
add_header X-Frame-Options "SAMEORIGIN" always;

# X-XSS-Protection
# Enables the browser's built-in XSS protection (for older browsers)
# Modern browsers use Content Security Policy instead
add_header X-XSS-Protection "1; mode=block" always;

# Content-Security-Policy
# Defines approved sources of content that browsers should be allowed to load
# This is a restrictive default - adjust based on your application's needs
# For development, you may need to relax these policies
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self'; frame-ancestors 'self';" always;

# Referrer-Policy
# Controls how much referrer information should be included with requests
# "strict-origin-when-cross-origin" provides a good balance between functionality and privacy
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Permissions-Policy (formerly Feature-Policy)
# Controls which browser features and APIs can be used
# This helps reduce the attack surface by disabling unnecessary features
add_header Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()" always;

# Strict-Transport-Security (HSTS)
# Forces browsers to use HTTPS for all future requests to this domain
# Only enable this when you have HTTPS properly configured
# Uncomment the following line when HTTPS is enabled:
# add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# X-Robots-Tag
# Controls how search engines index the site
# Remove or adjust this based on your SEO requirements
# add_header X-Robots-Tag "noindex, nofollow" always;

# =================================================================================================
# CORS Headers (Optional - uncomment if needed)
# =================================================================================================
#
# Cross-Origin Resource Sharing (CORS) headers
# Uncomment and configure these if your application needs to handle cross-origin requests
#
# add_header Access-Control-Allow-Origin "*" always;
# add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
# add_header Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With" always;
# add_header Access-Control-Max-Age "3600" always;
#
# Handle preflight OPTIONS requests
# if ($request_method = 'OPTIONS') {
#     add_header Access-Control-Allow-Origin "*";
#     add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
#     add_header Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With";
#     add_header Access-Control-Max-Age "3600";
#     add_header Content-Length 0;
#     add_header Content-Type text/plain;
#     return 204;
# }
#
# =================================================================================================
